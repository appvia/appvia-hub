<% credentials = global_credentials_for integration %>
<% if credentials.present? %>
  <div class="<%= container_css_class if local_assigns.key? :container_css_class -%>">
    <% panel_id = "credentials-panel-#{SecureRandom.hex(10)}" %>

    <%=
      tag.a(
        href: '#',
        data: {
          toggle: 'collapse',
          target: "##{panel_id}"
        },
        aria: {
          controls: panel_id
        }
      ) do
    %>
      <%= icon 'key'%>
      Robot credentials
      <%= icon 'caret-down', css_class: 'my-2' %>
    <% end %>

    <%=
      tag.div(
        id: panel_id,
        class: 'collapse'
      ) do
    %>
      <dl class="mt-2 card p-3 bg-light overflow-auto">
        <% credentials.each do |(k, v)| %>
          <dt><%= k -%></dt>
          <dd class="text-wrap text-break"><%= v -%></dd>
        <% end %>
      </dl>
    <% end %>
  </div>
  <div class="<%= container_css_class if local_assigns.key? :container_css_class -%>">
    <% panel_id = "setup-panel-#{SecureRandom.hex(10)}" %>
    <%=
      tag.a(
        href: '#',
        data: {
          toggle: 'collapse',
          target: "##{panel_id}"
        },
        aria: {
          controls: panel_id
        }
      ) do
    %>
      <%= icon 'question' %>
      Set up commands
      <%= icon 'caret-down', css_class: 'my-2' %>
    <% end %>
    <%=
      tag.div(
        id: panel_id,
        class: 'collapse'
      ) do
    %>
      <div class="mt-2 card p-3 bg-light overflow-auto">
        <%- case integration.provider_id -%>
        <%- when 'git_hub' %>
        <pre class="mb-0" style="white-space:normal;">
          <code>
            $ brew install git
          </code>
        </pre>
        <% documentation_url = 'https://guides.github.com/' %>
        <%- when 'kubernetes' %>
        <pre class="mb-0" style="white-space:normal;">
          <code>
            $ kubectl config set clusters.<%= integration.config['cluster_name'] %>.certificate-authority-data <%= integration.config['ca_cert'] %><br>
            $ kubectl config set-cluster <%= integration.config['cluster_name'] %> --server=<%= integration.config['api_url'] %><br>
            $ kubectl config set-credentials <%= integration.config['cluster_name'] %>-<%= integration.config['global_service_account_name'] %> --token=<%= integration.config['global_service_account_token'] %><br>
            $ kubectl config set-context <%= integration.config['cluster_name'] %>-<%= integration.config['global_service_account_name'] %> --cluster=<%= integration.config['cluster_name'] %> --user=<%= integration.config['cluster_name'] %>-<%= integration.config['global_service_account_name'] %>
          </code>
        </pre>
        <% documentation_url = 'https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands#config' %>
        <%- when 'ecr' %>
        <pre class="mb-0" style="white-space:normal;">
          <code>
            $ eval $(aws ecr get-login --region <%= integration.config['region'] %> --no-include-email --registry-ids <%= integration.config['account'] %>)
          </code>
        </pre>
        <% documentation_url = 'https://docs.aws.amazon.com/AmazonECR/latest/userguide/ECR_AWSCLI.html' %>
        <%- when 'quay' %>
        <pre class="mb-0" style="white-space:normal;">
          <code>
            $ docker login --username <%= integration.config['global_robot_name'] %> quay.io<br>
            login against server at https://quay.io/v1/<br>
            password: <%= integration.config['global_robot_token'] %><br>
            email: you@example.com<br>
            login succeeded
          </code>
        </pre>
        <% documentation_url = 'https://docs.quay.io/solution/getting-started.html' %><% end %>
      </div>
      <div class="mt-2">
        <%= icon 'book' %>
        <%= link_to 'Further docs', documentation_url, target: '_blank' %>
      </div>
    <% end %>
  </div>
<% end %>
